<!DOCTYPE html>
<html>
<head>
	<title>SoundJS: Sound Tween</title>

	<link href="../_assets/css/shared.css" rel="stylesheet" type="text/css"/>
	<link href="../_assets/css/examples.css" rel="stylesheet" type="text/css"/>
	<link href="../_assets/css/soundjs.css" rel="stylesheet" type="text/css"/>
	<script src="../_assets/js/examples.js"></script>
</head>

<body onload="init()">

<header  class="SoundJS">
	<h1>Sound Tween</h1>

	<p>This example shows how to tween volume level.</p>
</header>

<div class="content" id="content">
	<p id="status">Startup.</p>
	<div>
		<button id="playBtn" onclick="handlePlaySound(event)">Load Sound</button>
		<button id="toggleBtn" onclick="handleToggleVolume(event)">Toggle Volume</button>
	</div>
</div>

<div id="error">
	<h2>Sorry!</h2>

	<p>SoundJS is not currently supported in your browser.</p>

	<p>Please <a href="http://github.com/CreateJS/SoundJS/issues" target="_blank">log a bug</a>
		with the device and browser you are using. Thank you.</p>
</div>

<div id="mobile">
	<h2>Sorry!</h2>

	<p>Mobile devices require sound to be played inside of user events, which
		this demo does not do.</p>

	<p>Please <a href="http://github.com/CreateJS/SoundJS/issues" target="_blank">log a bug</a>
		with the OS and browser if you see this on a device that is not mobile.
		Thank you.</p>
</div>

<script type="text/javascript" src="../_assets/libs/easeljs-NEXT.min.js"></script>
<!-- note tweenjs needs easeljs ticker -->
<script type="text/javascript" src="../_assets/libs/tweenjs-NEXT.min.js"></script>

<script type="text/javascript" src="../lib/soundjs-NEXT.combined.js"></script>
<!-- Note: FlashAudioPlugin is only needed to support older browsers -->
<script type="text/javascript" src="../lib/flashaudioplugin-NEXT.combined.js"></script>

<!-- We also provide hosted minified versions of all CreateJS libraries.
	http://code.createjs.com -->


<script id="editable">
	var soundInstance; 		// the soundInstance returned by Sound when we create or play a src
	var displayStatus;  	// the HTML element we use to display messages to the user
	var volume;		// 2 easeljs shapes to represent these values

	function init() {

		createjs.Sound.registerPlugins([createjs.WebAudioPlugin, createjs.HTMLAudioPlugin, createjs.FlashAudioPlugin]);

		if (!createjs.Sound.isReady()) {
			document.getElementById("error").style.display = "block";
			document.getElementById("content").style.display = "none";
			return;
		}

		// check if we are on a mobile device, as these currently require us to launch sound inside of a user event
		if (createjs.BrowserDetect.isIOS || createjs.BrowserDetect.isAndroid || createjs.BrowserDetect.isBlackberry) {
			document.getElementById("mobile").style.display = "block";
			document.getElementById("content").style.display = "none";
			return;
		}

		// store the DOM element so we do not have to keep looking it up
		displayStatus = document.getElementById("status");

		highVolume = true;

		playBtn = document.getElementById("playBtn");
		toggleBtn = document.getElementById("toggleBtn");
		toggleBtn.style.display = 'none';

		createjs.Sound.alternateExtensions = ["mp3"];	// add other extensions to try loading if the src file extension is not supported
		createjs.Sound.on("fileload", handleFileLoaded, this); // add an event listener for when load is completed
		createjs.Sound.registerSound("../_assets/audio/M-GameBG.ogg", "music");  // register sound, which preloads by default

		setMessage("Waiting for load to complete.");  // letting the user know what's happening
	}

	function handleFileLoaded(event) {
		setMessage("Ready to play");

		playBtn.innerHTML = "Play sound";
		toggleBtn.style.display = "none";
		toggleBtn.innerHTML = "Toggle Volume";
	}

	function handlePlaySound(event) {
		setMessage("Volume 100%");
		soundInstance = createjs.Sound.play("music", {loop: -1});
		playBtn.style.display = 'none';
		toggleBtn.style.display = "block";
	}

	function handleToggleVolume(event) {
		highVolume = !highVolume;
		setMusicVolume((highVolume) ? 1 : 0, 1000);
	}

	function setMusicVolume(volume, duration) {
		createjs.Tween.get(soundInstance, {override:true, onChange:handleChange}).to({volume:volume}, duration);
	}

	function handleChange(tween) {
		displayStatus.innerHTML = "Volume " + String(soundInstance.volume * 100 | 0) + "%";
	}

	function setMessage(message) {
		displayStatus.innerHTML = message;
	}
</script>

</body>
</html>
